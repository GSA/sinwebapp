version: 2.1

jobs:
    build_job:
        docker:
            - image: python:3.7.7-slim-stretch

        steps:
            - checkout
            - run: 
                name: Install Build Dependencies
                command: apt-get update -y && apt-get install -y curl
            - run: 
                name: Download CF CLI Binaries
                command: curl -L "https://packages.cloudfoundry.org/stable?release=linux64-binary&source=github&version=v6" | tar -zx
            - run: 
                name: Install CF CLI
                command: mv cf /usr/local/bin
            - run: 
                name: Install Node
                command: curl -sL https://deb.nodesource.com/setup_14.x | bash - && apt-get install -y nodejs 
            - run: 
                name: Setup Frontend For Cloud Deployment
                command: bash ./scripts/setup/setup-frontend-env.sh cloud
            - run:
                name: Install Dependencies and Build Frontend
                bash ./scripts/build-frontend.sh
            # TODO push to cloud
            # run
                # name Push to CloudFoundry 
                # command bash ./scripts/circleci-cf-push.sh

workflows: 
    build: 
        jobs:
            - build_job
                filters:
                    only: master